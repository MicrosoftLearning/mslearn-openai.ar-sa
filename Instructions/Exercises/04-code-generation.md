---
lab:
  title: إنشاء التعليمات البرمجية وتحسينها باستخدام خدمة Azure OpenAI
---

# إنشاء التعليمات البرمجية وتحسينها باستخدام خدمة Azure OpenAI

يمكن لنماذج خدمة Azure OpenAI إنشاء تعليمة برمجية لك باستخدام مطالبات اللغة الطبيعية، وإصلاح الأخطاء في التعليمة البرمجية المكتملة، وتوفير تعليقات التعليمة البرمجية. يمكن لهذه النماذج أيضًا شرح التعليمة البرمجية الموجودة وتبسيطها لمساعدتك على فهم ما يفعله وكيفية تحسينه.

في سيناريو هذا التمرين، ستؤدي دور مطور برامج يستكشف كيفية استخدام الذكاء الاصطناعي التوليدي لجعل مهام الترميز أسهل وأكثر كفاءة. يمكن تطبيق التقنيات المستخدمة في التمرين على ملفات التعليمات البرمجية الأخرى ولغات البرمجة وحالات الاستخدام.

سيستغرق هذا التمرين حوالي **25** دقيقة.

## توفير مورد Azure OpenAI

إذا لم يكن لديك موردًا بالفعل، يمكنك توفير مورد Azure OpenAI في اشتراك Azure الخاص بك.

1. سجّل الدخول إلى **Azure portal** من `https://portal.azure.com`.
2. إنشاء مورد **Azure OpenAI** بالإعدادات التالية:
    - **اشتراك**: *حدد اشتراك Azure الذي جرت الموافقة عليه للوصول إلى خدمة Azure OpenAI*
    - **مجموعة الموارد**: *اختيار مجموعة موارد أو إنشاءها*
    - **المنطقة**: *إجراء اختيار **عشوائي** من أي من المناطق التالية*\*
        - شرق أستراليا
        - شرق كندا
        - شرق الولايات المتحدة
        - East US 2
        - وسط فرنسا
        - شرق اليابان
        - وسط شمال الولايات المتحدة
        - منطقة السويد الوسطى
        - شمال سويسرا
        - جنوب المملكة المتحدة
    - **الاسم**: *اسم فريد من اختيارك*
    - **مستوى التسعير**: قياسي S0

    > \* موارد Azure OpenAI مقيدة بالحصص النسبية الإقليمية. تتضمن المناطق المدرجة الحصة النسبية الافتراضية لنوع (أنواع) النموذج المستخدمة في هذا التمرين. يؤدي اختيار منطقة عشوائيًا إلى تقليل مخاطر وصول منطقة واحدة إلى حد الحصة النسبية في السيناريوهات التي تشارك فيها اشتراكًا مع مستخدمين آخرين. في حالة الوصول إلى حد الحصة النسبية لاحقًا في التمرين، فمن المحتمل أنك قد تحتاج إلى إنشاء مورد آخر في منطقة مختلفة.

3. يُرجى الانتظار لاكتمال التوزيع. ثم انتقل إلى مورد Azure OpenAI الموزّع في مدخل Microsoft Azure.

## توزيع النموذج

يوفر Azure بوابة على الويب يسمى **بوابة Azure AI Foundry**، والتي يمكنك استخدامها لنشر النماذج وإدارتها واستكشافها. ستبدأ استكشافك لـ Azure OpenAI باستخدام بوابة Azure AI Foundry لنشر نموذج.

> **ملاحظة**: أثناء استخدام بوابة Azure AI Foundry، قد يتم عرض مربعات رسائل تقترح عليك تنفيذ مهام. يمكنك إغلاق هذه الخطوات واتباع الخطوات الواردة في هذا التمرين.

1. في بوابة Azure، في صفحة **نظرة عامة** لمورد Azure OpenAI الخاص بك، مرّر لأسفل إلى قسم **بدء الاستخدام** وحدد الزر للانتقال إلى **بوابة AI Foundry** (المعروفة سابقًا باسم AI Studio).
1. في بوابة Azure AI Foundry، في الجزء الموجود على اليسار، حدد صفحة **عمليات النشر** واعرض عمليات نشر النموذج الحالية لديك. إذا لم يكن لديك واحدة بالفعل، فعليك إنشاء توزيع جديد لنموذج **gpt-35-turbo-16k** بالإعدادات التالية:
    - **اسم التوزيع**: *اسم فريد من اختيارك*
    - **النموذج**: gpt-35-turbo-16k *(إذا لم يكن نموذج 16k متوفرًا، فاختر gpt-35-turbo)*
    - **إصدار النموذج**: *استخدام الإصدار الافتراضي*
    - **نوع التوزيع**: قياسي
    - **حد معدل الرموز المميزة في الدقيقة**: 5K\*
    - **عامل تصفية المحتوى**: افتراضية
    - **تمكين الحصة النسبية الديناميكية**: معطّل

    > \*الحد الأقصى لمعدل 5000 رمز مميز في الدقيقة هو أكثر من كاف لإكمال هذا التمرين مع ترك سعة للأشخاص الآخرين الذين يستخدمون نفس الاشتراك.

## إنشاء تعليمة برمجية في البيئة التجريبية للدردشة

قبل الاستخدام في تطبيقك، افحص كيفية قدرة Azure OpenAI على إنشاء التعليمات البرمجية وشرحها في البيئة التجريبية للدردشة.

1. في قسم **البيئة التجريبية**، حدد صفحة **دردشة**. تتكون صفحة بيئة **الدردشة** من صف من الأزرار ولوحتين رئيسيتين (والتي يمكن ترتيبها من اليمين إلى اليسار أفقيًا، أو من أعلى إلى أسفل عموديًا حسب دقة الشاشة لديك):
    - **التكوين** - يُستخدم لتحديد التوزيع الخاص بك، وتحديد رسالة النظام، وتعيين معلمات للتفاعل مع توزيعك.
    - **جلسة الدردشة** - تستخدم لإرسال رسائل الدردشة وعرض الاستجابات.
1. في جزء **عمليات التوزيع**، تأكد من تحديد توزيع نموذجك.
1. في مساحة **رسالة النظام**، قم بتعيين رسالة النظام إلى `You are a programming assistant helping write code` وقم بتطبيق التغييرات.
1. في **جلسة دردشة**، أرسل الاستعلام التالي:

    ```
    Write a function in python that takes a character and a string as input, and returns how many times the character appears in the string
    ```

    من المرجح أن يستجيب النموذج بدالة، مع بعض التوضيحات حول ما تفعله الوظيفة وكيفية استدعائها.

1. بعد ذلك، أرسل المطالبة `Do the same thing, but this time write it in C#`.

    من المرجح أن النموذج استجاب بشكل مشابه جدًا للمرة الأولى، ولكن هذه المرة باستخدام الترميز بلغة C#. يمكنك أن تطلب منه مرة أخرى لغة مختلفة من اختيارك، أو دالة لإكمال مهمة مختلفة مثل عكس سلسلة الإدخال.

1. بعد ذلك، دعونا نستكشف استخدام الذكاء الاصطناعي لفهم التعليمة البرمجية. أرسل المطالبة التالية كرسالة المستخدم.

    ```
    What does the following function do?  
    ---  
    def multiply(a, b):  
        result = 0  
        negative = False  
        if a < 0 and b > 0:  
            a = -a  
            negative = True  
        elif a > 0 and b < 0:  
            b = -b  
            negative = True  
        elif a < 0 and b < 0:  
            a = -a  
            b = -b  
        while b > 0:  
            result += a  
            b -= 1      
        if negative:  
            return -result  
        else:  
            return result  
    ```

    يجب أن يصف النموذج ما تفعله الدالة، وهو ضرب رقمين معًا باستخدام تكرار حلقي.

7. أرسل المطالبة `Can you simplify the function?`.

    يجب أن يكتب النموذج إصدارًا أبسط من الدالة.

8. إرسال المطالبة: `Add some comments to the function.`

    يضيف النموذج تعليقات إلى التعليمة البرمجية.

## الاستعداد لتطوير تطبيق في تعليمة Visual Studio البرمجية

الآن دعنا نستكشف كيفية إنشاء تطبيق مخصَّص يستخدم خدمة Azure OpenAI لإنشاء التعليمة البرمجية. ستقوم بتطوير تطبيقك باستخدام تعليمة Visual Studio البرمجية. تم توفير ملفات التعليمات البرمجية لتطبيقك في مستودع GitHub.

> **تلميح**: إذا نسخت بالفعل مستودع **mslearn-openai**، فافتحه في تعليمة Visual Studio البرمجية. وإلا فاتبع هذه الخطوات لاستنساخه إلى بيئة تطويرك.

1. ابدأ تشغيل Visual Studio Code.
2. افتح لوحة (SHIFT+CTRL+P) وشغّل **Git: استنسخ الأمر ** لاستنساخ مستودع `https://github.com/MicrosoftLearning/mslearn-openai` إلى مجلد محلي (لا يُهم أي مجلد).
3. عند استنساخ المستودع، افتح المجلد في Visual Studio Code.

    > **ملاحظة**: إذا عرضت لك Visual Studio Code رسالة منبثقة لمطالبتك بالثقة في التعليمات البرمجية التي تفتحها، فانقر فوق **نعم، أثق في خيار الكُتاب** في النافذة المنبثقة.

4. انتظر حتى تثبيت ملفات إضافية لدعم مشاريع التعليمات البرمجية C# في المستودع.

    > **ملاحظة**: في حالة مطالبتك بإضافة الأصول المطلوبة للبناء وتصحيح الأخطاء، فحدد **ليس الآن**.

## تكوين تطبيقك

تم توفير تطبيقات لكل من C# وPython، وكذلك ملف نصي نموذجي ستستخدمه لاختبار التلخيص. يتميز كلا التطبيقين بالوظيفة نفسها. أولاً، ستكمل بعض الأجزاء الرئيسية من التطبيق لتمكين استخدام مورد Azure OpenAI الخاص بك.

1. في تعليمة Visual Studio البرمجية في جزء **المستكشف**، انتقِل إلى المجلد **Labfiles/04-code-generation** وعليك توسيع المجلد **CSharp** أو **Python** حسب تفضيل اللغة لديك. يحتوي كل مجلد على الملفات الخاصة باللغة للتطبيق الذي تريد دمج وظيفة Azure OpenAI فيه.
2. انقر بزر الماوس الأيمن فوق المجلد **CSharp** أو **Python** الذي يحتوي على ملفات التعليمات البرمجية الخاصة بك وافتح وحدة طرفية متكاملة. ثم، عليك تثبيت حزمة Azure OpenAI SDK عن طريق تشغيل الأمر المناسب لتفضيل اللغة لديك:

    **C#:**

    ```
    dotnet add package Azure.AI.OpenAI --version 1.0.0-beta.14
    ```

    **Python**:

    ```
    pip install openai==1.55.3
    ```

3. في جزء **مستكشف**، في مجلد **CSharp** أو **Python**، افتح ملف التكوين للغة المفضلة لديك

    - **C#**: appsettings.json
    - **Python**: .env
    
4. تحديث قيم التكوين لتشمل:
    - **نقطة النهاية** و**مفتاح** من مورد Azure OpenAI الذي أنشأته (متوفر في صفحة **المفاتيح ونقطة النهاية** لمورد Azure OpenAI الخاص بك في مدخل Microsoft Azure)
    - **اسم عملية النشر** الذي حددته لنشر النموذج الخاص بك (متوفر في صفحة **عمليات النشر** في بوابة Azure AI Foundry).
5. احفظ ملف التكوين.

## إضافة تعليمة برمجية لاستخدام نموذج خدمة Azure OpenAI

أنت الآن جاهز لاستخدام Azure OpenAI SDK لاستهلاك نموذجك الموزع.

1. في جزء **المستكشف**، في مجلد **CSharp** أو **Python**، افتح ملف التعليمة البرمجية الخاص باللغة المفضلة لديك. في الدالة التي تستدعي نموذج Azure OpenAI، ضمن ***تنسيق التعليق وإرسال الطلب إلى النموذج***، أضف التعليمات البرمجية لتنسيق وإرسال الطلب إلى النموذج.

    **C#**: Program.cs

    ```csharp
    // Format and send the request to the model
    var chatCompletionsOptions = new ChatCompletionsOptions()
    {
        Messages =
        {
            new ChatRequestSystemMessage(systemPrompt),
            new ChatRequestUserMessage(userPrompt)
        },
        Temperature = 0.7f,
        MaxTokens = 1000,
        DeploymentName = oaiDeploymentName
    };

    // Get response from Azure OpenAI
    Response<ChatCompletions> response = await client.GetChatCompletionsAsync(chatCompletionsOptions);

    ChatCompletions completions = response.Value;
    string completion = completions.Choices[0].Message.Content;
    ```

    **Python**: code-generation.py

    ```python
    # Format and send the request to the model
    messages =[
        {"role": "system", "content": system_message},
        {"role": "user", "content": user_message},
    ]
    
    # Call the Azure OpenAI model
    response = client.chat.completions.create(
        model=model,
        messages=messages,
        temperature=0.7,
        max_tokens=1000
    )
    ```

4. احفظ التغييرات في ملف التعليمة البرمجية.

## شغّل التطبيق

الآن بعد أن تم تكوين التطبيق الخاص بك، قم بتشغيله لمحاولة إنشاء التعليمة البرمجية لكل حالة استخدام. يتم ترقيم حالة الاستخدام في التطبيق، ويمكن تشغيلها بأي ترتيب.

> **ملاحظة**: قد يواجه بعض المستخدمين تحديدًا للمعدّل في حالة استدعاء النموذج بشكل متكرر للغاية. إذا واجهت خطأً بخصوص تحديد معدّل الرمز المميز، فانتظر لمدة دقيقة ثم حاول مرة أخرى.

1. في جزء **المستكشف**، عليك توسيع المجلد **Labfiles/04-code-generation/sample-code** وراجع الدالة وتطبيق *go-fish* للغتك. سيتم استخدام هذه الملفات للمهام في التطبيق.
2. في جزء الوحدة الطرفية التفاعلية، تأكد من أن سياق المجلد هو المجلد الخاص باللغة المفضلة لديك. ثم أدخل الأمر التالي لتشغيل التطبيق.

    - **C#:** `dotnet run`
    - **Python**: `python code-generation.py`

    > **تلميح**: يمكنك استخدام أيقونة **تكبير حجم اللوحة** (**^**) في شريط أدوات المحطة الطرفية لرؤية المزيد من نص وحدة التحكم.

3. اختر الخيار 1 لإضافة تعليقات إلى التعليمة البرمجية الخاص بك وأدخل المطالبة التالية. لاحظ أن الاستجابة قد تستغرق بضع ثوانٍ لكل من هذه المهام.

    ```prompt
    Add comments to the following function. Return only the commented code.\n---\n
    ```

    سيتم وضع النتائج في **result/app.txt**. افتح هذا الملف، وقارنه بملف الدالة الموجود في **sample-code**.

4. بعد ذلك، اختر الخيار **2** لكتابة اختبارات الوحدة لنفس الدالة وأدخل المطالبة التالية.

    ```prompt
    Write four unit tests for the following function.\n---\n
    ```

    ستحل النتائج محل ما كان موجودًا في **result/app.txt**، وتفاصيل أربع اختبارات وحدة لهذه الدالة.

5. بعد ذلك، اختر الخيار **3** لإصلاح الأخطاء في التطبيق للعب Go Fish. أدخل المطالبة التالية.

    ```prompt
    Fix the code below for an app to play Go Fish with the user. Return only the corrected code.\n---\n
    ```

    ستحل النتائج محل ما كان موجودًا في **result/app.txt**، ويجب أن يكون لها تعليمة برمجية مشابهة جدًا مع تصحيح بعض الأشياء.

    - **C#**: يتم إجراء إصلاحات على السطرين 30 و59
    - **Python**: يتم إجراء إصلاحات على السطرين 18 و31

    يمكن تشغيل تطبيق Go Fish في **sample-code** إذا قمت باستبدال الأسطر التي تحتوي على أخطاء بالاستجابة من Azure OpenAI. إذا قمت بتشغيله دون الإصلاحات، فلن يعمل بشكل صحيح.
    
    > **ملاحظة**: من الأهمية بمكان ملاحظة أنه على الرغم من تصحيح التعليمات البرمجية لتطبيق Go Fish هذا لبعض بناء الجملة، إلا أنه ليس تمثيلاً دقيقًا تمامًا للعبة. إذا تمعنت بدقة، ستجد مشاكل تتعلق بعدم التحقق مما إذا كانت المجموعة فارغة عند سحب البطاقات، وعدم إزالة الأزواج من يد اللاعب عندما يحصل على زوج، وبعض الأخطاء الأخرى التي تتطلب فهم ألعاب البطاقات لتحقيقها. يُعدَّ هذا مثالاً رائعًا لكيفية مساعدة نماذج الذكاء الاصطناعي التوليدي المفيدة في إنشاء التعليمات البرمجية، ولكن لا يمكن الوثوق بصحتها ويجب التحقق منها من قِبل المطور.

    إذا كنت ترغب في رؤية الاستجابة الكاملة من Azure OpenAI، يمكنك تعيين متغيّر **printFullResponse** إلى `True`، وإعادة تشغيل التطبيق.

## تنظيف

عند الانتهاء من مورد Azure OpenAI، تذكر حذف التوزيع أو المورد بأكمله في **مدخل Microsoft Azure** في `https://portal.azure.com`.
